const licensesInfo = [
  {
    name: "Бесплатный",
    content: `
                    <div class="licenses__settings">
                      <p class="licenses__settings--item1">
                        Тариф доступен всем пользователям
                      </p>
                      <span
                        class="vertical-line licenses__settings--item2"
                      ></span>
                      <p class="licenses__settings--item3">
                        Диск 5 ГБ
                        <span class="little-text">
                          Без общего диска для компаний
                        </span>
                      </p>
                      <span
                        class="vertical-line licenses__settings--item4"
                      ></span>
                      <p class="licenses__settings--item5">
                        Бесплатно за всех пользователей
                      </p>
                    </div>
                    <div class="item__main__content">
                      <p>Внутренний ИИ</p>
                      <p>
                        Календарь для каждого сотрудника для планирования
                        мероприятий
                      </p>
                      <p>Организационная структура компании</p>
                      <p>Виртуальный отдел управления персоналом</p>
                      <p>
                        Новостная лента в стиле Facebook для внутренних
                        коммуникаций.
                      </p>
                      <p>Внутренний мессенджер с функциями WhatsApp</p>
                      <p>
                        Контакт-центр - интегрирующий все каналы заказов в
                        единую систему управления.
                      </p>
                      <p>Конструктор сайтов с бесплатным хостингом</p>
                      <p>База знаний компании</p>
                      <p>Каталог товаров</p>
                      <p>Автоматизация продаж через CRM</p>
                      <p>Чек-ин на работе с геопозицией</p>
                      <p>Работа с виртуальными задачами</p>
                    </div>
                  `,
  },
  {
    name: "Базовый",
    content: `
                    <div class="licenses__settings">
                      <p class="licenses__settings--item1">
                        До 5 пользователей
                      </p>
                      <span
                        class="vertical-line licenses__settings--item2"
                      ></span>
                      <p class="licenses__settings--item3">
                        Диск 24 ГБ
                        <span class="little-text">
                          Без общего диска для компаний
                        </span>
                      </p>
                      <span
                        class="vertical-line licenses__settings--item4"
                      ></span>
                      <p class="licenses__settings--item5">
                        9&nbsp;000₸/мес <br>
                        86&nbsp;400₸/год
                      </p>
                    </div>
                    <div class="item__main__content">
                     <p>Складской учет</p>
                     <p>Внутренний ИИ</p>
                     <p>Демонстрация экрана</p>
                     <p>Контакт-центр - интегрирующий все каналы  заказов в единую систему управления.</p>
                     <p>Новостная лента в стиле Facebook  для внутренних коммуникаций.</p>
                     <p>Интеграция с почтой ( 7 дней )</p>
                     <p>Внутренний мессенджер с функциями WhatsApp</p>
                     <p>Автогенерация счетов на оплату</p>
                     <p>Конструктор сайтов с бесплатным хостингом</p>
                     <p>Календарь для каждого сотрудника для планирования мероприятий</p>
                     <p>Организационная структура компании</p>
                     <p>Виртуальный отдел управления персоналом</p>
                     <p>Автоматизация рабочих процессов через CRM</p>
                     <p>База знаний компании</p>
                     <p>Чек-ин на работе с геопозицией</p>
                     <p>Автоматизация продаж через CRM</p>
                     <p>Каталог товаров</p>
                     <p>Работа с виртуальными задачами</p>
                    </div>
                  `,
  },
  {
    name: "Стандартный",
    content: `
                    <div class="licenses__settings">
                      <p class="licenses__settings--item1">
                        До 50 пользователей
                      </p>
                      <span
                        class="vertical-line licenses__settings--item2"
                      ></span>
                      <p class="licenses__settings--item3">
                        Диск 100 ГБ

                      </p>
                      <span
                        class="vertical-line licenses__settings--item4"
                      ></span>
                      <p class="licenses__settings--item5">
                        24&nbsp;000₸/мес <br>
                        230&nbsp;400₸/год
                      </p>
                    </div>
                    <div class="item__main__content">
                      <p>Новостная лента в стиле Facebook  для внутренних коммуникаций.</p>
                    <p>Внутренний мессенджер с функциями WhatsApp
и редактировнием документов</p>
                    <p>Внутренний ИИ</p>
                    <p>Демонстрация экрана</p>
                    <p>Контакт-центр - интегрирующий все каналы  заказов в единую систему управления.</p>
                    <p>Календарь для каждого сотрудника для планирования мероприятий</p>
                    <p>Виртуальный отдел управления персоналом</p>
                    <p>Организационная структура компании</p>
                    <p>Автогенерация счетов на оплату</p>
                    <p>Автоматизация рабочих процессов через CRM</p>
                    <p>Работа с виртуальными задачами</p>
                    <p>Интеграция с почтой ( 7 дней )</p>
                    <p>Складской учет</p>
                    <p>Возможность пригласить внешних пользователей
в рабочие группы ( Экстра-нет )</p>
                    <p>Коэффициент полезности каждого сотрудника</p>
                    <p>Работа с виртуальными пректами</p>
                    <p>Bi- конструктор</p>
                    <p>Маркетинговый кабинет</p>
                    <p>Конструктор сайтов с бесплатным хостингом</p>
                    <p>База знаний компании</p>
                    <p>Чек-ин на работе с геопозицией</p>
                    <p>Автоматизация продаж через CRM</p>
                    <p>Каталог товаров</p>
                    </div>
                  `,
  },
  {
    name: "Профессиональный",
    content: `
                    <div class="licenses__settings">
                      <p class="licenses__settings--item1">
                        До 100 пользователей
                      </p>
                      <span
                        class="vertical-line licenses__settings--item2"
                      ></span>
                      <p class="licenses__settings--item3">
                        Диск 1 ТБ
              
                      </p>
                      <span
                        class="vertical-line licenses__settings--item4"
                      ></span>
                      <p class="licenses__settings--item5">
                        45&nbsp;000₸/мес <br>
                        432&nbsp;000₸/год
                      </p>
                    </div>
                    <div class="item__main__content">
                    <p>Внутренний ИИ</p>
                    <p>Демонстрация экрана</p>
                    <p>Конструктор сайтов с бесплатным хостингом</p>
                    <p>Контакт-центр - интегрирующий все каналы  заказов в единую систему управления.</p>
                    <p>Календарь для каждого сотрудника для планирования мероприятий</p>
                    <p>Виртуальный отдел управления персоналом</p>
                    <p>Организационная структура компании</p>
                    <p>База знаний компании с возможностью ограничить права доступа</p>
                    <p>Чек-ин на работе с геопозицией</p>
                    <p>Автогенерация счетов на оплату</p>
                    <p>Автоматизация рабочих процессов через CRM</p>
                    <p>Автогенерация счетов на оплату и КП</p>
                    <p>Виртуальные задачи с учетом времени, делегированием и пользовательскими полями</p>
                    <p>Интеграция с почтой ( 7 дней )</p>
                    <p>Складской учет</p>
                    <p>Возможность пригласить внешних пользователей в рабочие группы ( Экстра-нет )</p>
                    <p>Коэффициент полезности каждого сотрудника</p>
                    <p>Работа с виртуальными пректами</p>
                    <p>Bi- конструктор и конструктор отчетов</p>
                    <p>Маркетинговый кабинет</p>
                    <p>Задачи по подразделениям</p>
                    <p>Бизнес-процессы и смарт-процессы</p>
                    <p>Сквозная аналитика</p>
                    <p>Автоматизация продаж через CRM</p>
                    <p>Каталог товаров</p>
                    <p>Гибкие методологии и управления командами ( Скрам )</p>
                    </div>
                  `,
  },
  {
    name: "Энтерпрайз",
    content: `
                    <div class="licenses__settings">
                      <p class="licenses__settings--item1">
                        от 250 пользователей
                      </p>
                      <span
                        class="vertical-line licenses__settings--item2"
                      ></span>
                      <p class="licenses__settings--item3">
                        Диск 3 ТБ
        
                      </p>
                      <span
                        class="vertical-line licenses__settings--item4"
                      ></span>
                      <p class="licenses__settings--item5">
                        100&nbsp;000₸/мес
                      </p>
                    </div>
                    <div class="item__main__content">
                      <p>Новостная лента в стиле Facebook  для внутренних коммуникаций.</p>
                      <p>Внутренний мессенджер с функциями WhatsApp и редактировнием документов</p>
                      <p>Внутренний ИИ</p>
                      <p>Демонстрация экрана</p>
                      <p>Конструктор сайтов с бесплатным хостингом</p>
                      <p>Контакт-центр - интегрирующий все каналы  заказов в единую систему управления.</p>
                      <p>Календарь для каждого сотрудника для планирования мероприятий</p>
                      <p>Виртуальный отдел управления персоналом</p>
                      <p>Организационная структура компании</p>
                      <p>База знаний компании с возможностью ограничить права доступа</p>
                      <p>Чек-ин на работе с геопозицией</p>
                      <p>Автоматизация продаж через CRM</p>
                      <p>Автогенерация счетов на оплату</p>
                      <p>Автоматизация рабочих процессов через CRM</p>
                      <p>Автогенерация счетов на оплату и КП</p>
                      <p>Каталог товаров</p>
                      <p>Виртуальные задачи с учетом времени, делегированием и пользовательскими полями</p>
                      <p>Интеграция с почтой ( 7 дней )</p>
                      <p>Складской учет</p>
                      <p>Возможность пригласить внешних пользователей в рабочие группы ( Экстра-нет )</p>
                      <p>Коэффициент полезности каждого сотрудника</p>
                      <p>Работа с виртуальными пректами</p>
                      <p>Bi- конструктор и конструктор отчетов</p>
                      <p>Маркетинговый кабинет</p>
                      <p>Задачи по подразделениям</p>
                      <p>Гибкие методологии и управления командами ( Скрам )</p>
                      <p>Бизнес-процессы и смарт-процессы</p>
                      <p>Сквозная аналитика</p>
                      <p>Создание и управление филиалами</p>
                      <p>Интерпрайз-кластер  с ускорением до 10-ти раз</p>
                    </div>
              `,
  },
];

document.addEventListener("DOMContentLoaded", function () {
  //  ЭЛЕМЕНТ ДЛЯ ЗАДЕРЖКИ МЕЖДУ НАЖАТИЕМ КНОПОК
  let ready = true;

  // ТАРИФЫ
  const toTarifsBtns = document.querySelectorAll(".to_tarifs-block");
  // ДОП. БЛОКИ СЛЕВА
  const leftSection = document.querySelectorAll(".slideIn_left");
  const openLeftSection = document.querySelectorAll(".open_left_section");
  const hideLeftSection = document.querySelectorAll(".hide_left_section");
  const cases_all = document.querySelector(".cases_all");

  // ПОПАП
  const popup__contact_us = document.querySelector(".popup__contact_us");

  // КОНСУЛЬТАЦИЯ
  const consultation_Page = document.querySelector(".consultation");

  // ПОЛИТИКА КОНФ.
  const privacyPolicy_Page = document.querySelector(".privacy-policy");

  //  ОБСЛУЖИВАНИЕ
  const service_Page = document.querySelector(".service");

  // КАРТОЧКИ ТАРИФА
  const tarifsList = document.querySelector(".tarifs-block__list");

  const tarifs_background = document.querySelector(".tarifs-block__background");

  // ПЕРЕКЛЮЧАТЕЛЬ СЛАЙДОВ НА БЛОКЕ МОДУЛЕЙ
  const toggler = document.querySelector(
    ".modulesBlockSwiper-navigation__toggler"
  );
  // FAQ
  const faq_list = document.querySelector(".faq__list");

  // ПЕРЕХОД К ТАРИФАМ
  toTarifsBtns.forEach((btn) => {
    btn.addEventListener("click", () => {
      mainSlider.moveTo(5);
    });
  });

  // ОТКРЫТИЕ ТАРИФА КАК ПОПАП
  function openPopup(item) {
    let parentBlockPosition = item.offsetTop;
    let popup = item.querySelector(".item__wrapper");
    let content = item.querySelector(".item__header").nextElementSibling;

    if (!tarifs_background.classList.contains("active")) {
      tarifs_background.classList.add("active"); // включаем темный фон

      // Поднимаем блок вверх
      item.style.position = "static";
      item.style.height = `${popup.offsetHeight}px`;
      popup.style.position = "absolute";
      popup.style.top = `${parentBlockPosition}px`;

      setTimeout(() => {
        popup.classList.add("active");
        popup.style.top = "20px";
      }, 20);

      // Раскрываем блок
      setTimeout(() => {
        content.style.maxHeight = content.scrollHeight + "px";
      }, 300);
    }
  }
  popup__contact_us.addEventListener("click", (e) => {
    let content = e.target.closest(".popup__contact_us__container");
    let close = e.target.closest(".popup__contact_us--close");
    if ((!content || close) && ready) {
      ready = false;
      popup__contact_us.classList.toggle("active");
      setTimeout(() => {
        ready = true;
      }, 300);
    }
  });

  // Функция для закрытия блока
  function closePopup(item) {
    let parentBlockPosition = item.offsetTop;
    let popup = item.querySelector(".item__wrapper");
    let content = item.querySelector(".item__header").nextElementSibling;

    if (tarifs_background.classList.contains("active")) {
      // Сворачиваем блок
      content.style.maxHeight = null;

      // Опускаем блок вниз
      setTimeout(() => {
        popup.style.top = `${parentBlockPosition}px`;
        tarifs_background.classList.remove("active");
      }, 300);

      setTimeout(() => {
        popup.classList.remove("active");
      }, 600);
    }
  }

  // Обработчик кликов по элементам

  tarifsList.addEventListener("click", (e) => {
    let item = e.target.closest(".item");
    if (item.id === "individual") return;
    let licensesBtn = e.target.closest(".change-licenses-tarif");
    const icon = item.querySelector(".plus-icon");

    if (licensesBtn) {
      document
        .querySelector(".change-licenses-tarif.active")
        .classList.remove("active");
      let licensesWrapper = item.querySelector(".licenses-wrapper");
      let itemMain = item.querySelector(".item__main");
      let dataInfo = licensesBtn.getAttribute("data-name");
      licensesBtn.classList.add("active");
      const findedLicenses = licensesInfo.find((x) => x.name === dataInfo);
      licensesWrapper.innerHTML = "";
      licensesWrapper.innerHTML = findedLicenses.content;
      licensesWrapper.style.maxHeight = licensesWrapper.scrollHeight + "px";
      itemMain.style.maxHeight = itemMain.scrollHeight + "px";
    } else if (item && ready) {
      icon.classList.toggle("active");
      ready = false;
      if (window.innerWidth >= 1200) {
        !tarifs_background.classList.contains("active")
          ? openPopup(item)
          : closePopup(item);
      } else {
        let content = item.querySelector(".item__header").nextElementSibling;

        if (content.style.maxHeight) {
          content.style.transition = ".7s";
          content.style.maxHeight = null;
        } else {
          content.style.transition = "1s";
          content.style.maxHeight = content.scrollHeight + "px";
        }
      }

      setTimeout(() => {
        ready = true;
      }, 500);
    }
  });

  const painBlockCard = document.querySelectorAll(".pain__card__header");

  painBlockCard.forEach((header) => {
    header.addEventListener("click", () => {
      const body = header.nextElementSibling;
      const arrow = header.querySelector(".pain__arrow");
      if (body.style.maxHeight) {
        body.style.maxHeight = null;
        arrow.classList.remove("active");
      } else {
        body.style.maxHeight = body.scrollHeight + "px";
        arrow.classList.add("active");
      }
    });
  });

  const loadImages = (section) => {
    const images = section.querySelectorAll("img[data-src]");

    if (images) {
      images.forEach((img) => {
        img.setAttribute("src", img.getAttribute("data-src"));
        img.removeAttribute("data-src");
      });
    }
  };

  // ДОБАВИТЬ АКТИВНЫЙ КЛАСС ДЛЯ ЛЕВОЙ СЕКЦИИ
  const addClassToSection = (name) => {
    switch (name) {
      case "consultation":
        loadImages(consultation_Page);
        consultation_Page.classList.toggle("active");
        break;
      case "privacy-policy":
        privacyPolicy_Page.classList.toggle("active");
        break;
      case "service":
        loadImages(service_Page);
        service_Page.classList.toggle("active");
        break;
      case "casesAll":
        loadImages(cases_all);
        cases_all.classList.toggle("active");
        break;
    }
  };

  // ОТКРЫТЬ СЕКЦИЮ
  openLeftSection.forEach((btn) => {
    btn.addEventListener("click", () => {
      let sectionName = btn.getAttribute("data-name");
      btn.disabled = true;
      setTimeout(() => {
        btn.disabled = false;
      }, 500);
      leftSection.forEach((section) => {
        section.style.visibility = "visible";
        section.style.opacity = "1";
      });
      addClassToSection(sectionName);
    });
  });

  // ЗАКРЫТЬ СЕКЦИЮ
  hideLeftSection.forEach((btn) => {
    btn.addEventListener("click", () => {
      let sectionName = btn.getAttribute("data-name");
      addClassToSection(sectionName);
    });
  });

  // ОТКРЫТИЕ КАРТОЧЕК В FAQ
  faq_list.addEventListener("click", (e) => {
    const card = e.target.closest(".faq__card");
    if (card) {
      const main = card.querySelector(".faq__main");
      const icon = card.querySelector(".plus-icon");
      if (main.style.maxHeight) {
        main.style.maxHeight = null;
        icon.classList.toggle("active");
      } else {
        main.style.maxHeight = main.scrollHeight + "px";
        icon.classList.toggle("active");
      }
    }
  });

  const mainSlider = new fullpage("#main", {
    scrollOverflow: true,
    scrolloverflowmacstyle: false,
    menu: "#menu",
    anchors: ["1", "2", "3", "4", "5", "6", "7", "8"],
    responsiveWidth: 1200,
  });

  // СЛАЙДЕРЫ НА БЛОКЕ МОДУЛЕЙ
  const modulesBlockSwiper = new Swiper("#modulesBlockSwiper", {
    speed: 500,
    spaceBetween: 30,
    slidesPerView: 1,
    allowTouchMove: false,
    // autoHeight: true,
    navigation: {
      nextEl: ".swiper-button-next",
      prevEl: ".swiper-button-prev",
    },
    breakpoints: {
      769: {
        slidesPerView: 2,
      },
    },
    on: {
      slideChange: function () {
        // Получаем активный слайд
        if (this.activeIndex) {
          toggler.style.left = "50%";
        } else {
          toggler.style.left = "0%";
        }
      },
    },
  });

  const modulesCardSwiper = new Swiper("#modules-card-swiper1", {
    speed: 500,
    grabCursor: true,
    mousewheel: true,
    pagination: {
      el: ".swiper-pagination",
      clickable: true,
    },
    navigation: {
      nextEl: ".swiper-button-next",
      prevEl: ".swiper-button-prev",
    },
  });

  const modulesCardSwiper2 = new Swiper("#modules-card-swiper2", {
    speed: 500,
    grabCursor: true,
    mousewheel: true,
    pagination: {
      el: ".swiper-pagination",
      clickable: true,
    },
    navigation: {
      nextEl: ".swiper-button-next",
      prevEl: ".swiper-button-prev",
    },
  });

  const painBlockSwiper = new Swiper("#painBlockSwiper", {
    direction: "horizontal",
    slidesPerView: 1,
    allowTouchMove: true,
    spaceBetween: 30,

    pagination: {
      el: ".swiper-pagination",
    },
    breakpoints: {
      769: {
        allowTouchMove: false,
        spaceBetween: 0,
      },
    },
  });

  const possibilitiesBlockSwiper = new Swiper("#possibilitiesBlockSwiper", {
    direction: "horizontal",
    slidesPerView: 1,
    spaceBetween: 30,

    pagination: {
      el: ".swiper-pagination",
    },
    breakpoints: {
      526: {
        slidesPerView: 2,
      },
    },
  });

  const casesBlockSwiper = new Swiper("#casesBlockSwiper", {
    direction: "horizontal",
    slidesPerView: 1,
    spaceBetween: 30,

    pagination: {
      el: ".swiper-pagination",
    },
    breakpoints: {
      526: {
        slidesPerView: 2,
      },
    },
  });

  const trustUs = new Swiper("#trustUs", {
    direction: "horizontal",
    spaceBetween: 20,
    slidesPerView: 2,
    slidesPerGroup: 2,
    mousewheel: true,
    grid: {
      rows: 3,
    },
    breakpoints: {
      769: {
        slidesPerView: 4,
        slidesPerGroup: 2,
        grid: {
          rows: 2,
        },
      },

      525: {
        slidesPerView: 3,
        slidesPerGroup: 2,
        grid: {
          rows: 2,
        },
      },
    },
    pagination: {
      el: ".trustUs_container-pagination",
    },

    navigation: {
      nextEl: ".trustUs_container-button-next",
      prevEl: ".trustUs_container-button-prev",
    },
  });

  function animateCounters() {
    const counters = document.querySelectorAll(".counter");
    const duration = 500; // Длительность анимации в миллисекундах

    counters.forEach((counter) => {
      const target = +counter.getAttribute("data-target");
      const format = counter.getAttribute("data-format");
      const startTime = performance.now();

      function updateCounter(currentTime) {
        const elapsedTime = currentTime - startTime;
        const progress = Math.min(elapsedTime / duration, 1);
        let currentNumber = Math.floor(progress * target);

        if (format === "million") {
          currentNumber = currentNumber + " млн";
        } else if (format === "percent") {
          currentNumber = currentNumber + "%";
        }

        counter.textContent = currentNumber;

        if (progress < 1) {
          requestAnimationFrame(updateCounter);
        }
      }

      requestAnimationFrame(updateCounter);
    });
  }

  animateCounters();
  const play_sound = document.querySelectorAll("button.case_with_review");

  play_sound.forEach((btn) => {
    btn.addEventListener("click", function () {
      let name = btn.getAttribute("data-name");
      const audioPlayers = document.querySelectorAll("audio");
      const thisPLayer = Array.from(audioPlayers).find(
        (player) => player.getAttribute("data-name") === name
      );
      let playBtn = btn.querySelector(".play_button");
      let pauseBtn = btn.querySelector(".pause_button");
      if (thisPLayer.paused) {
        audioPlayers.forEach((x) => {
          x.pause();
          play_sound.forEach((btn) => {
            btn.querySelector(".play_button").style.opacity = 1;
            btn.querySelector(".pause_button").style.opacity = 0;
          });
        });
        thisPLayer.play();
        playBtn.style.opacity = 0;
        pauseBtn.style.opacity = 1;
      } else {
        thisPLayer.pause();
        playBtn.style.opacity = 1;
        pauseBtn.style.opacity = 0;
      }
    });
  });


  // ЛОГИКА НУМЕРОВКИ ПРОБЛЕМ В БИТРИКСЕ
  const painNumbers = document.querySelectorAll(".pain__number")

  const painNumbers_URL = [
    "https://static.tildacdn.com/tild3866-3735-4839-a539-313665653834/numbers-1.svg",
    "https://static.tildacdn.com/tild6662-3964-4065-b663-373366386431/numbers-2.svg",
    "https://static.tildacdn.com/tild3839-3237-4333-b364-396536646436/numbers-3.svg",
    "https://static.tildacdn.com/tild3161-6361-4434-a437-353161373132/numbers-4.svg",
    "https://static.tildacdn.com/tild6638-3331-4234-b636-353039353962/numbers-5.svg",
    "https://static.tildacdn.com/tild3663-3131-4130-b831-363931656638/numbers-6.svg",
    "https://static.tildacdn.com/tild6134-3834-4234-b635-646636353937/numbers-7.svg",
    "https://static.tildacdn.com/tild6536-6565-4437-b865-353932656437/numbers-8.svg",
  ]


  
  painNumbers.forEach((num, index) => {
    num.src = painNumbers_URL[index]
  })

});


